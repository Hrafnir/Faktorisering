<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Primtallsøving – Faktorisering & Sil</title>
<style>
  :root{
    --bg:#000; --panel:#0b0f12; --ink:#fff; --muted:#c1c7cd;
    --accent:#42ff9e; --accent2:#59caff;
    --gold:#ffd54a; --gold2:#ffb300; --gold3:#fff0a6;
    --warn:#ffd166; --err:#ff5252; --border:#283544; --grid:#1e2937;
    --strikeBlue:#0c2e6f; /* mørk blå for strøkne celler */
  }
  *{box-sizing:border-box}
  body{margin:0; padding:28px; background:var(--bg); color:var(--ink);
       font:18px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
  h1{margin:0 0 6px; font-size:clamp(24px,4.5vw,40px)}
  .sub{color:var(--muted); margin:0 0 18px}

  .tabs{display:flex; gap:12px; margin:14px 0 20px}
  .tab{border:2px solid var(--border); background:#0e141a; color:var(--ink);
       padding:12px 18px; border-radius:16px; cursor:pointer; font-weight:700; letter-spacing:.2px}
  .tab[aria-selected="true"]{outline:3px solid var(--accent2); background:#0f1822}
  .panel{display:none}
  .panel[aria-hidden="false"]{display:block}

  .controls{display:flex; flex-wrap:wrap; gap:14px; align-items:end; margin:12px 0 18px}
  label{display:flex; flex-direction:column; gap:6px; font-size:15px}

  .input-xl{
    background:#0e141a; color:var(--ink); border:2px solid var(--border); border-radius:14px;
    padding:14px 16px; min-width:220px; font-size:20px; font-weight:700;
  }
  .input-md{
    background:#0e141a; color:var(--ink); border:2px solid var(--border); border-radius:14px;
    padding:12px 14px; min-width:180px; font-size:18px; font-weight:700;
  }
  button{
    background:#0e141a; color:var(--ink); border:2px solid var(--border); border-radius:14px;
    padding:12px 16px; cursor:pointer; font-weight:800; letter-spacing:.2px
  }
  button.primary{background:var(--accent2); color:#001018; border-color:transparent}
  button.good{background:var(--accent); color:#00180a; border-color:transparent}
  button.warn{background:var(--warn); color:#2b2000; border-color:transparent}
  button:disabled{opacity:.55; cursor:not-allowed}
  .toggle{display:inline-flex; gap:10px; align-items:center}
  .grow{flex:1}

  .card{background:var(--panel); border:2px solid var(--border); border-radius:20px; padding:20px}
  .status{margin-top:10px; font-size:18px}
  .status .ok{color:var(--accent)}
  .status .bad{color:var(--err)}
  .hint{color:var(--muted); font-size:15px; margin-top:12px}

  /* Stolpemetoden */
  .ladder{display:grid; grid-template-columns: 1fr 8px 180px; gap:0; width:min(760px,100%); margin:0 auto; font-family:ui-monospace,monospace; font-size:30px}
  .ladder .bar{background:#ffffff26}
  .ladder .cell{padding:8px 12px; min-height:50px; display:flex; align-items:center; justify-content:flex-end; border-bottom:2px solid var(--grid)}
  .ladder .cell.right{justify-content:flex-start}

  .chips{display:flex; flex-wrap:wrap; gap:12px}
  .chip{background:#0e141a; border:2px solid var(--border); border-radius:999px; padding:10px 14px; cursor:pointer; font-weight:700}
  .chip:hover{outline:3px solid var(--accent2)}

  /* SIL 1–100 */
  .grid-wrap{
    background:
      linear-gradient(#121a23,#121a23) padding-box,
      repeating-linear-gradient(to right, transparent 0 1px, #0d1319 1px 72px) border-box,
      repeating-linear-gradient(to bottom, transparent 0 1px, #0d1319 1px 72px) border-box;
    border:2px solid var(--grid);
    border-radius:16px;
    padding:10px;
  }
  .grid{display:grid; grid-template-columns:repeat(10,72px); grid-auto-rows:72px; gap:8px;
        justify-content:center; width:100%; margin:0 auto}
  .cell100{
    border:2px solid var(--grid); border-radius:12px;
    background:#ffffff;            /* HVIT fra start */
    color:#000000;                 /* Sorte tall */
    font-weight:900; font-size:22px;
    display:flex; align-items:center; justify-content:center;
    user-select:none; position:relative; transition:transform .08s ease;
    box-shadow: inset 0 0 0 1px #00000022;
  }
  /* 2s "pop før stryk" animasjon */
  .cell100.strike-anim{
    animation: strikeOut 2s ease-in-out forwards;
  }
  @keyframes strikeOut{
    0%   { transform: scale(1.00); background:#ffffff; color:#000000; }
    20%  { transform: scale(1.22); }
    50%  { transform: scale(1.00); }
    70%  { transform: scale(1.10); }
    100% { transform: scale(1.00); background: var(--strikeBlue); color:#cfe3ff; }
  }
  .cell100.struck{
    background:var(--strikeBlue);
    color:#cfe3ff;
    text-decoration:line-through; text-decoration-thickness:3px;
  }

  /* Ferdig-markering: “pop” + gull-glød */
  .cell100.prime-final{
    color:#2a1b00;
    background: radial-gradient(ellipse at center, var(--gold3) 0%, #ffe680 55%, #fff 100%);
    box-shadow: 0 0 0 3px var(--gold), 0 0 26px 6px #ffd54a88;
    animation: primePop .65s ease-out forwards;
  }
  @keyframes primePop{
    0%   { transform: scale(1.00); }
    35%  { transform: scale(1.28); }
    70%  { transform: scale(1.00); }
    100% { transform: scale(1.10); } /* litt større enn start */
  }

  .row-primes{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:16px}
  .pbtn{background:#0e141a; color:#fff; border:2px solid var(--border); border-radius:12px; padding:10px 12px; cursor:pointer; min-width:48px; font-weight:800}
  .pbtn.active{background:#102133; outline:3px solid var(--accent2)}
  .legend{display:flex; gap:16px; justify-content:center; margin:10px 0 0; color:var(--muted); font-size:14px}
  .legend .box{width:22px; height:22px; border-radius:6px; display:inline-block; vertical-align:middle; margin-right:6px; border:2px solid var(--grid)}
  .legend .box.start{background:#ffffff}
  .legend .box.struck{background:var(--strikeBlue)}
  .legend .box.prime{background:radial-gradient(circle, var(--gold3), var(--gold))}
</style>
</head>
<body>
  <h1>Primtallsøving</h1>
  <div class="sub">Fane 1: faktoriser et tall ved å velge <b>laveste</b> primfaktor. Fane 2: sil 1–100 – det holder å bruke <b>2, 3, 5, 7</b>. Når ingen flere kan strykes, “popper” alle primtall i gull.</div>

  <div class="tabs" role="tablist">
    <button id="tab-factor" class="tab" role="tab" aria-selected="true" aria-controls="panel-factor">Faktorisering</button>
    <button id="tab-sieve"  class="tab" role="tab" aria-selected="false" aria-controls="panel-sieve">Primtall-sil (1–100)</button>
  </div>

  <!-- FANE: FAKTORISERING -->
  <section id="panel-factor" class="panel" aria-hidden="false" aria-labelledby="tab-factor">
    <div class="controls">
      <label>Nytt tall
        <input id="nInput" class="input-xl" type="number" min="2" step="1" value="130"/>
      </label>
      <button id="btnRandom">Tilfeldig tall</button>
      <button id="btnStart" class="primary">Start</button>
      <button id="btnReset">Nullstill</button>
      <div class="grow"></div>
      <label class="toggle"><input id="useButtons" type="checkbox"/> Bruk primtall-knapper</label>
    </div>

    <div class="card">
      <div id="ladder" class="ladder" aria-live="polite"></div>

      <div id="manualBox" class="controls">
        <label>Neste primfaktor
          <input id="primeGuess" class="input-md" type="number" min="2" step="1" placeholder="2, 3, 5, 7, ..."/>
        </label>
        <button id="btnCheck">Sjekk</button>
      </div>

      <div id="buttonsBox" class="chips" style="display:none"></div>

      <div id="status" class="status"></div>
      <div id="result" class="status"></div>

      <div class="hint">
        Velg alltid <b>laveste</b> primtall som deler resttallet. Når du treffer, deler vi og legger en ny linje i tabellen.
      </div>
    </div>
  </section>

  <!-- FANE: SIL 1–100 -->
  <section id="panel-sieve" class="panel" aria-hidden="true" aria-labelledby="tab-sieve">
    <div class="card">
      <div class="grid-wrap">
        <div id="grid" class="grid" aria-live="polite"></div>
      </div>
      <div class="row-primes" id="primeRow"></div>
      <div class="legend">
        <span><span class="box start"></span>Start</span>
        <span><span class="box struck"></span>Stryket (delelig)</span>
        <span><span class="box prime"></span>Primtall (ferdig)</span>
      </div>
      <div id="sieveMsg" class="status"></div>
      <div class="hint">
        Klikk 2, deretter 3, 5, 7. Når ingen flere kan strykes, popper primtallene i gull – da er vi ferdige!
      </div>
      <div class="controls" style="justify-content:center">
        <button id="resetSieve">Nullstill sil</button>
      </div>
    </div>
  </section>

<script>
/* ====== Mattehjelpere ====== */
const sievePrimes=(limit=100)=>{const a=new Uint8Array(limit+1);const out=[];for(let i=2;i<=limit;i++){if(!a[i]){out.push(i);if(i*i<=limit)for(let j=i*i;j<=limit;j+=i)a[j]=1}}return out};
const smallestDiv=(n)=>{if(n%2===0)return 2;let p=3,cap=Math.floor(Math.sqrt(n));while(p<=cap){if(n%p===0)return p;p+=2}return n};
const isPrime=(n)=>{if(n<2) return false; return smallestDiv(n)===n;};

/* ====== FANE 1: Faktorisering ====== */
const nInput  = document.getElementById('nInput');
const btnRandom = document.getElementById('btnRandom');
const btnStart  = document.getElementById('btnStart');
const btnReset  = document.getElementById('btnReset');
const ladderEl  = document.getElementById('ladder');
const statusEl  = document.getElementById('status');
const resultEl  = document.getElementById('result');

const manualBox = document.getElementById('manualBox');
const primeGuess = document.getElementById('primeGuess');
const btnCheck   = document.getElementById('btnCheck');
const useButtons = document.getElementById('useButtons');
const buttonsBox = document.getElementById('buttonsBox');

let state = {orig:130, cur:130, left:[130], right:[]};

const renderLadder=(left,right)=>{
  ladderEl.innerHTML='';
  const rows=Math.max(left.length,right.length);
  for(let i=0;i<rows;i++){
    const L=document.createElement('div'); L.className='cell'; L.textContent=left[i]??'';
    const BAR=document.createElement('div'); BAR.className='bar';
    const R=document.createElement('div'); R.className='cell right'; R.textContent=right[i]??'';
    ladderEl.appendChild(L); ladderEl.appendChild(BAR); ladderEl.appendChild(R);
  }
};
const resetFactor=()=>{
  const n=+nInput.value||130;
  state={orig:n, cur:n, left:[n], right:[]};
  renderLadder(state.left,state.right);
  statusEl.textContent='Klar. Skriv laveste primfaktor.';
  resultEl.textContent='';
  primeGuess.value='';
  buildPrimeButtons();
};
const buildPrimeButtons=()=>{
  buttonsBox.innerHTML='';
  const ps=sievePrimes(200);
  ps.forEach(p=>{
    const b=document.createElement('button');
    b.className='chip'; b.textContent=p;
    b.onclick=()=> checkPrime(p);
    buttonsBox.appendChild(b);
  });
};
const checkPrime=(g)=>{
  if(state.cur<=1) return;
  if(state.cur%g!==0){ statusEl.innerHTML=`<span class="bad">${g} deler ikke ${state.cur}.</span>`; return; }
  const s=smallestDiv(state.cur);
  if(g!==s){ statusEl.innerHTML=`<span class="bad">Nesten. ${g} deler ${state.cur}, men <b>${s}</b> er lavere.</span>`; return; }

  state.right.push(g);
  if(g===state.cur){
    if(state.left.at(-1)!==g) state.left.push(g);
    state.cur=1;
  }else{
    state.cur/=g;
    state.left.push(state.cur);
  }
  renderLadder(state.left,state.right);

  if(state.cur>1){
    statusEl.innerHTML=`<span class="ok">Riktig!</span> Del på ${g}. Fortsett.`;
  }else{
    statusEl.innerHTML=`<span class="ok">Ferdig!</span>`;
    resultEl.innerHTML = `${state.orig} = <b>${state.right.join(' · ')}</b>`;
  }
};
btnCheck.onclick=()=>{ const v=+primeGuess.value; if(!v) return; checkPrime(v); primeGuess.value=''; primeGuess.focus(); };
primeGuess.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); btnCheck.click(); }});
useButtons.onchange=()=>{
  const on=useButtons.checked;
  buttonsBox.style.display = on? 'flex':'none';
  manualBox.style.display  = on? 'none':'flex';
};
btnStart.onclick=resetFactor;
btnReset.onclick=resetFactor;
btnRandom.onclick=()=>{ nInput.value = Math.floor(10+Math.random()*50000); resetFactor(); };
resetFactor();

/* ====== FANE 2: Primtall-sil 1–100 ====== */
const gridEl = document.getElementById('grid');
const primeRow = document.getElementById('primeRow');
const sieveMsg = document.getElementById('sieveMsg');
const resetSieve = document.getElementById('resetSieve');

let sieve = {selected:[], struck:new Set(), done:false, animating:false};
const primes100 = sievePrimes(100);
const bases = [2,3,5,7]; // nok for 1–100

const buildGrid=()=>{
  gridEl.innerHTML=''; sieve.struck.clear(); sieve.done=false; sieve.selected=[]; sieve.animating=false;
  for(let i=1;i<=100;i++){
    const c=document.createElement('div');
    c.className='cell100'; c.dataset.n=i; c.textContent=i;
    gridEl.appendChild(c);
  }
  buildPrimeButtonsRow();
  sieveMsg.textContent='Start med 2, deretter 3, 5, 7.';
};
const buildPrimeButtonsRow=()=>{
  primeRow.innerHTML='';
  primes100.forEach(p=>{
    const b=document.createElement('button'); b.className='pbtn'; b.textContent=p; b.dataset.p=p;
    b.onclick=()=> clickPrime(p,b);
    if(sieve.done) b.disabled=true;
    primeRow.appendChild(b);
  });
};

const disablePrimeButtons = (flag)=> {
  for(const b of primeRow.children){ b.disabled = flag; }
};

const clickPrime=(p,btn)=>{
  if(sieve.done || sieve.animating) return;
  btn.classList.add('active');

  // Finn alle nye celler som skal strykes nå
  const toStrike=[];
  for(const cell of gridEl.children){
    const n=+cell.dataset.n;
    if(n!==p && n%p===0 && !cell.classList.contains('struck') && !cell.classList.contains('strike-anim')){
      toStrike.push(cell);
    }
  }

  // Hvis ingen nye – sjekk om vi er ferdig uansett
  if(toStrike.length===0){
    if(!sieve.selected.includes(p)) sieve.selected.push(p);
    postStrikeCheck(); // kan markere ferdig etter 7 selv uten nye stryk
    sieveMsg.textContent = nextSuggestion();
    return;
  }

  // Kjør 2s “pop før stryk”-animasjon på alle de nye
  sieve.animating = true;
  disablePrimeButtons(true);
  let left = toStrike.length;

  toStrike.forEach(cell=>{
    cell.classList.add('strike-anim');
    const done = ()=>{
      cell.removeEventListener('animationend', done);
      cell.classList.remove('strike-anim');
      cell.classList.add('struck');   // blir mørk blå permanent
      sieve.struck.add(+cell.dataset.n);
      left--;
      if(left===0){
        // ferdig med alle animasjoner for dette primtallet
        if(!sieve.selected.includes(p)) sieve.selected.push(p);
        sieve.animating = false;
        disablePrimeButtons(false);
        postStrikeCheck();
        sieveMsg.textContent = nextSuggestion();
      }
    };
    cell.addEventListener('animationend', done);
  });
};

function postStrikeCheck(){
  // Sjekk om alle gjenværende (>=2) er primtall
  const remaining2 = [...gridEl.children]
    .map(c=>+c.dataset.n)
    .filter(n=>n>=2 && !sieve.struck.has(n));

  const allPrime = remaining2.every(n => isPrime(n));
  const usedAllBases = bases.every(b => sieve.selected.includes(b));

  if(allPrime || usedAllBases){
    finishSieve();
  }
}

function finishSieve(){
  if(sieve.done) return;
  sieve.done = true;

  // “Pop” alle gjenværende primtall i gull
  for(const cell of gridEl.children){
    const n=+cell.dataset.n;
    if(n>=2 && !cell.classList.contains('struck') && isPrime(n)){
      cell.classList.remove('prime-final');
      void cell.offsetWidth; // reflow for å restarte animasjon
      cell.classList.add('prime-final');
    }
  }
  disablePrimeButtons(true);
  sieveMsg.innerHTML = `<span class="ok">Ferdig!</span> Vi kan ikke stryke flere tall. De som “popper” og lyser i gull er <b>alle primtallene under 100</b>.`;
}

const nextSuggestion=()=> {
  const used=new Set(sieve.selected);
  const order=[2,3,5,7,...primes100.filter(p=>p>7)];
  const next = order.find(x=>!used.has(x));
  return next? `Prøv ${next} neste.` : 'Alle nødvendige primtall er brukt.';
};

resetSieve.onclick=()=>{ buildGrid(); };

buildGrid();

/* ====== FANE-NAV ====== */
const tabFactor=document.getElementById('tab-factor');
const tabSieve =document.getElementById('tab-sieve');
const panelFactor=document.getElementById('panel-factor');
const panelSieve =document.getElementById('panel-sieve');
tabFactor.onclick=()=>{tabFactor.setAttribute('aria-selected',true);tabSieve.setAttribute('aria-selected',false);panelFactor.setAttribute('aria-hidden',false);panelSieve.setAttribute('aria-hidden',true);}
tabSieve.onclick =()=>{tabFactor.setAttribute('aria-selected',false);tabSieve.setAttribute('aria-selected',true);panelFactor.setAttribute('aria-hidden',true);panelSieve.setAttribute('aria-hidden',false);}
</script>
</body>
</html>
